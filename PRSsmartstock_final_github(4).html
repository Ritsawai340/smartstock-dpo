<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartStock ‡∏≠.‡∏™.‡∏Ñ. - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏ô‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; overflow-x: hidden; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .login-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); padding: 50px; border-radius: 25px; box-shadow: 0 25px 80px rgba(0,0,0,0.2); width: 100%; max-width: 450px; text-align: center; border: 1px solid rgba(255,255,255,0.3); animation: slideInUp 0.8s ease-out; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .login-logo { font-size: 5rem; margin-bottom: 25px; animation: float 3s ease-in-out infinite; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2)); }
        .login-title { font-size: 2.2rem; margin-bottom: 15px; color: #2c3e50; font-weight: 800; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .login-subtitle { color: #7f8c8d; margin-bottom: 35px; font-size: 1.1rem; font-weight: 500; }
        .form-group { margin-bottom: 25px; text-align: left; }
        label { display: block; margin-bottom: 10px; font-weight: 700; color: #2c3e50; font-size: 1rem; }
        input, select, textarea { width: 100%; padding: 15px 20px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 1.05rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15); transform: translateY(-2px); }
        .btn { display: inline-block; padding: 15px 30px; border: none; border-radius: 12px; cursor: pointer; font-size: 1.05rem; font-weight: 700; text-decoration: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); margin: 5px; position: relative; overflow: hidden; text-transform: uppercase; letter-spacing: 1px; }
        .btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s; }
        .btn:hover::before { left: 100%; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }
        .btn-secondary { background: linear-gradient(135deg, #6c757d 0%, #495057 100%); color: white; box-shadow: 0 10px 30px rgba(108, 117, 125, 0.3); }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3); }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; box-shadow: 0 10px 30px rgba(220, 53, 69, 0.3); }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); color: #212529; box-shadow: 0 10px 30px rgba(255, 193, 7, 0.3); }
        .btn-info { background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; box-shadow: 0 10px 30px rgba(23, 162, 184, 0.3); }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0,0,0,0.2); }
        .btn:active { transform: translateY(-1px); }
        .btn-sm { padding: 6px 10px; font-size: 0.75rem; min-width: 50px; height: 32px; display: flex; align-items: center; justify-content: center; }
        .header { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); padding: 25px; border-radius: 20px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; box-shadow: 0 15px 50px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.3); position: relative; overflow: hidden; }
        .header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2, #667eea); background-size: 200% 100%; animation: shimmer 3s ease-in-out infinite; }
        .header h1 { color: #2c3e50; font-size: 2.2rem; margin-bottom: 5px; font-weight: 800; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header p { color: #7f8c8d; font-size: 1rem; font-weight: 500; }
        .user-info { display: flex; align-items: center; gap: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 12px 20px; border-radius: 30px; border: 1px solid rgba(0,0,0,0.05); }
        .user-avatar { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
        .nav-tabs { display: flex; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-radius: 20px; padding: 8px; margin-bottom: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); overflow-x: auto; border: 1px solid rgba(255,255,255,0.3); }
        .nav-tab { flex: 1; padding: 15px 20px; text-align: center; background: transparent; border: none; border-radius: 12px; cursor: pointer; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); font-size: 1rem; font-weight: 600; white-space: nowrap; min-width: 140px; position: relative; overflow: hidden; }
        .nav-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transform: translateY(-3px); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4); }
        .nav-tab:hover:not(.active) { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .card { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-radius: 20px; padding: 30px; margin-bottom: 25px; box-shadow: 0 15px 50px rgba(0,0,0,0.08); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(255,255,255,0.3); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2, #667eea); background-size: 200% 100%; animation: shimmer 3s ease-in-out infinite; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 25px 80px rgba(0,0,0,0.15); }
        .card h3 { color: #2c3e50; margin-bottom: 25px; font-size: 1.6rem; font-weight: 700; background: linear-gradient(135deg, #2c3e50 0%, #667eea 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 25px; }
        .stat-card { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 15px 50px rgba(0,0,0,0.08); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.3); }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px; }
        .stat-card.green::before { background: linear-gradient(90deg, #27ae60, #2ecc71); }
        .stat-card.blue::before { background: linear-gradient(90deg, #3498db, #2980b9); }
        .stat-card.orange::before { background: linear-gradient(90deg, #f39c12, #e67e22); }
        .stat-card.red::before { background: linear-gradient(90deg, #e74c3c, #c0392b); }
        .stat-card.purple::before { background: linear-gradient(90deg, #9b59b6, #8e44ad); }
        .stat-card:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 25px 80px rgba(0,0,0,0.15); }
        .stat-number { font-size: 3rem; font-weight: 800; margin-bottom: 12px; background: linear-gradient(135deg, #2c3e50 0%, #667eea 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: pulse 2s ease-in-out infinite; }
        .stat-label { font-weight: 600; color: #7f8c8d; font-size: 1.1rem; }
        .quick-actions { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 25px; }
        .department-selector { display: flex; gap: 20px; margin-bottom: 25px; flex-wrap: wrap; }
        .dept-card { flex: 1; min-width: 250px; padding: 25px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-radius: 20px; text-align: center; cursor: pointer; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); border: 3px solid transparent; box-shadow: 0 10px 40px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
        .dept-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 20px 60px rgba(0,0,0,0.15); }
        .dept-card.selected { border-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; transform: translateY(-5px); box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4); }
        .dept-icon { font-size: 3.5rem; margin-bottom: 15px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1)); }
        .table-container { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-radius: 15px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.3); }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 18px; text-align: left; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; font-size: 0.95rem; }
        .table tr:hover { background: rgba(102, 126, 234, 0.05); transform: scale(1.01); transition: all 0.3s ease; }
        .status-badge { padding: 8px 16px; border-radius: 25px; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .status-normal { background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); color: #155724; border: 1px solid #b8dacc; }
        .status-warning { background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); color: #856404; border: 1px solid #f5c842; }
        .status-danger { background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); color: #721c24; border: 1px solid #f1aeb5; }
        .status-expired { background: linear-gradient(135deg, #343a40 0%, #495057 100%); color: white; border: 1px solid #6c757d; }
        .content-section { display: none; animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .content-section.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .hide { display: none !important; }
        .debug-panel { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: #2ecc71; padding: 20px; border-radius: 15px; margin-top: 20px; font-family: 'Courier New', monospace; font-size: 0.85rem; max-height: 250px; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); }
        .notification { position: fixed; top: 25px; right: 25px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); padding: 20px 25px; border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.2); z-index: 10000; transform: translateX(400px); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); max-width: 350px; border: 1px solid rgba(255,255,255,0.3); }
        .notification.show { transform: translateX(0); }
        .notification.success { border-left: 6px solid #28a745; }
        .notification.error { border-left: 6px solid #dc3545; }
        .notification.warning { border-left: 6px solid #ffc107; }
        .notification.info { border-left: 6px solid #17a2b8; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 10000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); padding: 40px; border-radius: 20px; width: 100%; max-width: 700px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 80px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.3); animation: scaleIn 0.3s ease-out; }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .modal h3 { color: #2c3e50; margin-bottom: 25px; font-size: 1.8rem; font-weight: 700; text-align: center; background: linear-gradient(135deg, #2c3e50 0%, #667eea 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .modal-buttons { display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px; flex-wrap: wrap; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .alert { padding: 20px 25px; border-radius: 15px; margin-bottom: 25px; border-left: 6px solid; backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .alert-success { background: rgba(212, 237, 218, 0.9); border-color: #28a745; color: #155724; }
        .alert-warning { background: rgba(255, 243, 205, 0.9); border-color: #ffc107; color: #856404; }
        .alert-danger { background: rgba(248, 215, 218, 0.9); border-color: #dc3545; color: #721c24; }
        .alert-info { background: rgba(209, 236, 241, 0.9); border-color: #17a2b8; color: #0c5460; }

        /* New styles for improved features */
        .item-selector-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .item-button { 
            background: rgba(255,255,255,0.95); 
            backdrop-filter: blur(20px); 
            border: 3px solid transparent; 
            border-radius: 20px; 
            padding: 25px 20px; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        .item-button:hover { 
            transform: translateY(-5px) scale(1.02); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.15); 
            border-color: #667eea;
        }
        .item-button.selected { 
            border-color: #667eea; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            transform: translateY(-5px); 
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4); 
        }
        .item-button .item-name { 
            font-weight: 700; 
            font-size: 1.1rem; 
            margin-bottom: 8px;
            line-height: 1.2;
        }
        .item-button .item-stock { 
            font-size: 0.9rem; 
            opacity: 0.8; 
        }
        .item-button .item-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        .quick-entry-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            display: none;
        }
        .quick-entry-panel.show {
            display: block;
            animation: slideDown 0.4s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .quantity-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .quantity-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .quantity-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .quantity-display {
            font-size: 2rem;
            font-weight: bold;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        .report-content {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .summary-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border-left: 5px solid #667eea;
        }
        .summary-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .summary-label {
            color: #7f8c8d;
            font-weight: 600;
        }

        @media (max-width: 768px) { 
            .container { padding: 15px; } 
            .header { flex-direction: column; text-align: center; padding: 20px; } 
            .header h1 { font-size: 1.8rem; } 
            .nav-tabs { flex-direction: column; gap: 5px; } 
            .nav-tab { padding: 15px 20px; margin-bottom: 0; } 
            .stats-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; } 
            .department-selector { flex-direction: column; } 
            .quick-actions { justify-content: center; } 
            .table-container { overflow-x: auto; } 
            .table { min-width: 600px; } 
            .table th, .table td { padding: 12px 10px; font-size: 0.9rem; } 
            .form-grid { grid-template-columns: 1fr; } 
            .item-selector-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
            .item-button { padding: 20px 15px; min-height: 100px; }
            .quantity-input-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">üêÑ</div>
            <h2 class="login-title">SmartStock ‡∏≠.‡∏™.‡∏Ñ.</h2>
            <p class="login-subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏ô‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞<br>‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏ô‡∏°‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢</p>
            
            <div class="form-group">
                <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                <input type="email" id="loginEmail" placeholder="example@dairy.co.th" required>
            </div>
            <div class="form-group">
                <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input type="password" id="loginPassword" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" onclick="doLogin()" style="width: 100%;">
                    üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>

            <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffecb3 100%); padding: 15px; border-radius: 10px; margin-top: 20px; border: 1px solid rgba(255,193,7,0.3); text-align: center;">
                <div style="font-size: 0.9rem; color: #e65100; margin-bottom: 5px;">
                    <strong>üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</strong>
                </div>
                <div style="color: #bf360c; font-size: 0.8rem; line-height: 1.4;">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô<br>
                    ‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); padding: 20px; border-radius: 15px; margin-top: 25px; border: 1px solid rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 1.2rem; margin-bottom: 10px;">üìû ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô</div>
                <div style="color: #555; font-size: 0.95rem; line-height: 1.5;">
                    <strong>‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</strong><br>
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: <strong style="color: #1976d2;">‡πÅ‡∏ú‡∏ô‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏ô‡∏°</strong><br>
                    <small style="color: #666;">‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÇ‡∏Ñ‡∏ô‡∏°</small><br><br>
                    <small style="color: #888; font-style: italic;">
                        üí° ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                    </small>
                </div>
            </div>
            
            <div style="margin-top: 15px; text-align: center;">
                <button type="button" onclick="showSecretPanel()" style="background: none; border: none; color: #ccc; font-size: 0.7rem; cursor: pointer; opacity: 0.3;">...</button>
            </div>
            
            <div id="debugInfo" class="debug-panel hide">
                <div style="color: #ecf0f1; margin-bottom: 10px; font-weight: bold;">üîß Debug Console:</div>
                <div id="debugLog"></div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="container hide" id="mainApp">
        <div class="header">
            <div>
                <h1>üöÄ SmartStock ‡∏≠.‡∏™.‡∏Ñ.</h1>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏ô‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <span id="userName">Admin</span>
                <button class="btn btn-danger" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('dashboard')">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
            <button class="nav-tab" onclick="showSection('inventory')">üì¶ ‡∏™‡∏ï‡πä‡∏≠‡∏Å</button>
            <button class="nav-tab" onclick="showSection('record')">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button class="nav-tab" onclick="showSection('reports')">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
            <button class="nav-tab" onclick="showSection('alerts')">üö® ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
            <button class="nav-tab" onclick="showSection('management')">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card green">
                    <div class="stat-number" id="totalItems">13</div>
                    <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-number" id="totalValue">0</div>
                    <div class="stat-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-number" id="lowStock">0</div>
                    <div class="stat-label">‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-number" id="expiringSoon">0</div>
                    <div class="stat-label">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-number" id="expiredItems">0</div>
                    <div class="stat-label">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="refreshData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button class="btn btn-success" onclick="exportToExcel()">üìä Export Excel</button>
                <button class="btn btn-secondary" onclick="exportData()">üìÑ Export JSON</button>
                <button class="btn btn-info" onclick="backupData()">üíæ ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button class="btn btn-warning" onclick="showItemModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
            </div>

            <div class="card">
                <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</h3>
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <div class="stat-number" id="farmValue">0</div>
                        <div class="stat-label">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏° (‡∏ö‡∏≤‡∏ó)</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-number" id="breedingValue">0</div>
                        <div class="stat-label">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó)</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üîÑ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="recentActivities">
                    <p style="color: #7f8c8d; font-style: italic;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                </div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventory" class="content-section">
            <div class="card">
                <h3>üåæ ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏Å‡∏Å.)</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="farmInventoryTable">
                            <tr><td colspan="7" style="text-align: center; padding: 20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>üêÇ ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</h3>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏Å‡∏Å.)</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="breedingInventoryTable">
                            <tr><td colspan="7" style="text-align: center; padding: 20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Record Section -->
        <div id="record" class="content-section">
            <div class="department-selector">
                <div class="dept-card selected" onclick="selectDepartment('farm')" id="deptFarm">
                    <div class="dept-icon">üåæ</div>
                    <h4>‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</h4>
                    <p>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ú‡∏™‡∏° TMR</p>
                </div>
                <div class="dept-card" onclick="selectDepartment('breeding')" id="deptBreeding">
                    <div class="dept-icon">üêÇ</div>
                    <h4>‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</h4>
                    <p>‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô‡πÇ‡∏Ñ‡∏ô‡∏°</p>
                </div>
            </div>

            <!-- Traditional Form (Original) -->
            <div class="card hide" id="traditionalForm">
                <h3 id="recordTitle">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö-‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h4 style="margin: 0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="toggleEntryMode('quick')" id="quickModeBtn">
                            üöÄ ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏£‡πá‡∏ß (‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà)
                        </button>
                        <button class="btn btn-secondary" onclick="toggleEntryMode('traditional')" id="traditionalModeBtn">
                            üìã ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ü‡∏≠‡∏£‡πå‡∏°)
                        </button>
                    </div>
                </div>

                <form onsubmit="submitRecord(event)" id="recordForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                            <input type="date" id="recordDate" required>
                        </div>
                        <div class="form-group">
                            <label>‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <input type="time" id="recordTime" required>
                        </div>
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                            <select id="transactionType" required onchange="toggleFormFields()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="in">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                <option value="out">‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                            <select id="itemSelect" required onchange="calculateAutoPrice()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input type="number" id="quantity" step="0.1" min="0" required onchange="calculateAutoPrice()">
                        </div>
                        <div class="form-group price-input-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="totalPrice" step="0.01" min="0" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°" onchange="calculatePricePerKg()">
                            <small style="color: #666;">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</small>
                        </div>
                        <div class="form-group price-input-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="unitPrice" step="0.01" min="0" onchange="calculateTotalPrice()">
                            <small style="color: #666;">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ</small>
                        </div>
                        <div class="form-group supplier-group">
                            <label>‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="supplier" required>
                        </div>
                        <div class="form-group">
                            <label>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á/‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å-‡πÉ‡∏ö‡∏£‡∏±‡∏ö</label>
                            <input type="text" id="documentRef" placeholder="‡πÄ‡∏ä‡πà‡∏ô INV-2025-001, REQ-2025-050">
                            <small style="color: #666;">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</small>
                        </div>
                        <div class="form-group">
                            <label>‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                            <input type="text" id="recorder" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="notes" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
                    </div>

                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button type="submit" class="btn btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">üîÑ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
                    </div>
                </form>
            </div>

            <!-- Quick Entry Mode -->
            <div class="card" id="quickEntryMode">
                <h3>üöÄ ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡πá‡∏ß - <span id="quickModeTitle">‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</span></h3>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h4 style="margin: 0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h4>
                        <p style="color: #666; margin: 5px 0 0 0;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="toggleEntryMode('traditional')" id="traditionalModeBtn2">
                            üìã ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ü‡∏≠‡∏£‡πå‡∏°)
                        </button>
                        <button class="btn btn-primary" onclick="toggleEntryMode('quick')" id="quickModeBtn2">
                            üöÄ ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏£‡πá‡∏ß (‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà)
                        </button>
                    </div>
                </div>

                <div class="item-selector-grid" id="itemSelectorGrid">
                    <!-- Item buttons will be populated here -->
                </div>

                <div class="quick-entry-panel" id="quickEntryPanel">
                    <h4 style="margin-bottom: 20px;">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <span id="selectedItemName"></span></h4>
                    
                    <div class="form-grid" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                            <select id="quickTransactionType" required onchange="toggleQuickFormFields()">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                                <option value="in">üîµ ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                <option value="out">üî¥ ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="date" id="quickDate" required style="flex: 1;">
                                <input type="time" id="quickTime" required style="flex: 1;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                        <div class="quantity-input-group">
                            <button type="button" class="quantity-btn" onclick="testQuantityButton(-100)" title="‡∏•‡∏î 100">-100</button>
                            <button type="button" class="quantity-btn" onclick="testQuantityButton(-10)" title="‡∏•‡∏î 10">-10</button>
                            <button type="button" class="quantity-btn" onclick="testQuantityButton(-1)" title="‡∏•‡∏î 1">-1</button>
                            <div class="quantity-display" id="quickQuantityDisplay">0</div>
                            <button type="button" class="quantity-btn" onclick="testQuantityButton(1)" title="‡πÄ‡∏û‡∏¥‡πà‡∏° 1">+1</button>
                            <button type="button" class="quantity-btn" onclick="testQuantityButton(10)" title="‡πÄ‡∏û‡∏¥‡πà‡∏° 10">+10</button>
                            <button type="button" class="quantity-btn" onclick="testQuantityButton(100)" title="‡πÄ‡∏û‡∏¥‡πà‡∏° 100">+100</button>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <input type="number" id="quickQuantityInput" 
                                   style="width: 200px; text-align: center; font-size: 1.2rem; font-weight: bold;"
                                   placeholder="‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" step="0.1" min="0" 
                                   oninput="updateQuantityDisplay()" onchange="updateQuantityDisplay()">
                        </div>
                    </div>

                    <div id="quickPriceFields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="quickTotalPrice" step="0.01" min="0" onchange="calculateQuickPricePerKg()">
                            </div>
                            <div class="form-group">
                                <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏° (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" id="quickUnitPrice" step="0.01" min="0" onchange="calculateQuickTotalPrice()">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="quickSupplier" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á/‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å-‡πÉ‡∏ö‡∏£‡∏±‡∏ö</label>
                        <input type="text" id="quickDocumentRef" placeholder="‡πÄ‡∏ä‡πà‡∏ô INV-2025-001, REQ-2025-050">
                        <small style="color: #666;">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
                    </div>

                    <div class="form-group">
                        <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="quickNotes" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)"></textarea>
                    </div>

                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button type="button" class="btn btn-primary" onclick="submitQuickRecord()" style="font-size: 1.2rem; padding: 20px 40px;">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearQuantity()">
                            üîÑ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå
                        </button>
                        <button type="button" class="btn btn-warning" onclick="cancelQuickEntry()">
                            ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="content-section">
            <div class="card">
                <h3>üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                
                <div class="form-grid" style="margin-bottom: 25px;">
                    <div class="form-group">
                        <label>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <select id="chartPeriod" onchange="updateUsageChart()">
                            <option value="daily">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</option>
                            <option value="monthly">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</option>
                            <option value="quarterly">‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ (4 ‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</option>
                            <option value="yearly">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (3 ‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
                        <select id="chartDepartment" onchange="updateUsageChart()">
                            <option value="all">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</option>
                            <option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏£‡∏≤‡∏ü</label>
                        <select id="chartType" onchange="updateUsageChart()">
                            <option value="bar">‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏£‡∏≤‡∏ü</option>
                            <option value="line">‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü</option>
                            <option value="pie">‡∏ß‡∏á‡∏Å‡∏•‡∏° (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" onclick="updateUsageChart()">üîÑ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏£‡∏≤‡∏ü</button>
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <canvas id="usageChart" width="800" height="400"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                
                <div class="form-grid" style="margin-bottom: 25px;">
                    <div class="form-group">
                        <label>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <select id="reportPeriod">
                            <option value="7">7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                            <option value="14">14 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                            <option value="30">30 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                            <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                        </select>
                    </div>
                    <div class="form-group" id="customDateGroup" style="display: none;">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô - ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="date" id="reportStartDate">
                            <input type="date" id="reportEndDate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
                        <select id="reportDepartment">
                            <option value="all">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</option>
                            <option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
                        <select id="reportType">
                            <option value="usage">‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                            <option value="receiving">‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</option>
                            <option value="summary">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° (‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ + ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="generateUsageReport()">üîç ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                            <button class="btn btn-success" onclick="exportReportToExcel()">üìä Export Excel</button>
                        </div>
                    </div>
                </div>

                <div id="reportResults">
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏ú‡∏ô‡∏Å ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üö® ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</h3>
                
                <div class="form-grid" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label>‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (%)</label>
                        <input type="number" id="anomalyThreshold" value="30" min="10" max="100" placeholder="30">
                        <small style="color: #666;">‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</small>
                    </div>
                    <div class="form-group">
                        <label>‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</label>
                        <select id="compareInterval">
                            <option value="daily">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
                            <option value="weekly">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                            <option value="monthly">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-warning" onclick="detectAnomalies()">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</button>
                    </div>
                </div>

                <div id="anomalyResults">
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥:</strong> 
                        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏î‡∏•‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°</h3>
                <div id="overallStats">
                    <div class="stats-grid">
                        <div class="stat-card blue">
                            <div class="stat-number" id="totalTransactions">0</div>
                            <div class="stat-label">‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="stat-card green">
                            <div class="stat-number" id="avgDailyUsage">0</div>
                            <div class="stat-label">‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô (‡∏Å‡∏Å.)</div>
                        </div>
                        <div class="stat-card orange">
                            <div class="stat-number" id="peakUsageDay">-</div>
                            <div class="stat-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                        </div>
                        <div class="stat-card purple">
                            <div class="stat-number" id="mostUsedItem">-</div>
                            <div class="stat-label">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Section -->
        <div id="alerts" class="content-section">
            <div class="card">
                <h3>üö® ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h3>
                <div id="alertsContent">
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏ö‡∏ö Real-time
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ (%)</label>
                        <input type="number" id="lowStockPercent" value="20" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ß‡∏±‡∏ô)</label>
                        <input type="number" id="expiryDays" value="7" min="1" max="30">
                    </div>
                    <div class="form-group">
                        <label>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Email</label>
                        <input type="email" id="alertEmail" placeholder="admin@dairy.co.th">
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveAlertSettings()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            </div>
        </div>

        <!-- Management Section -->
        <div id="management" class="content-section">
            <div class="card">
                <h3>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <p style="color: #7f8c8d;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>
                    </div>
                    <button class="btn btn-primary" onclick="showItemModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
                </div>

                <div class="form-grid" style="margin-bottom: 25px; background: rgba(255,255,255,0.7); padding: 20px; border-radius: 15px;">
                    <div class="form-group">
                        <label>‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°</label>
                        <select id="sortBy" onchange="sortManagementTable()">
                            <option value="name">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (A-Z)</option>
                            <option value="name_desc">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Z-A)</option>
                            <option value="department">‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option value="stock_desc">‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢</option>
                            <option value="stock_asc">‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å</option>
                            <option value="price_desc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á ‚Üí ‡∏ï‡πà‡∏≥</option>
                            <option value="price_asc">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥ ‚Üí ‡∏™‡∏π‡∏á</option>
                            <option value="expiry_asc">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏£‡πá‡∏ß ‚Üí ‡∏ä‡πâ‡∏≤</option>
                            <option value="expiry_desc">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ä‡πâ‡∏≤ ‚Üí ‡πÄ‡∏£‡πá‡∏ß</option>
                            <option value="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô ‚Üí ‡∏õ‡∏Å‡∏ï‡∏¥)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</label>
                        <select id="filterDepartment" onchange="sortManagementTable()">
                            <option value="all">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</option>
                            <option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                        <select id="filterStatus" onchange="sortManagementTable()">
                            <option value="all">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                            <option value="normal">‡∏õ‡∏Å‡∏ï‡∏¥</option>
                            <option value="warning">‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</option>
                            <option value="danger">‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</option>
                            <option value="expired">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                                <th>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏Å‡∏Å.)</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="managementTable">
                            <tr><td colspan="7" style="text-align: center; padding: 20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Item Management Modal -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <h3 id="modalTitle">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="itemForm" onsubmit="saveItem(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <input type="text" id="itemName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î‡∏ö‡∏î">
                    </div>
                    <div class="form-group">
                        <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
                        <select id="itemDepartment" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏° (TMR)</option>
                            <option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏à‡∏∏‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏Å‡∏Å.)</label>
                        <input type="number" id="itemReorder" step="0.1" min="0" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 100">
                        <small style="color: #666;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</label>
                    <input type="text" id="itemPackaging" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 30 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö">
                </div>

                <div class="form-group">
                    <label>‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏â‡∏û‡∏≤‡∏∞</label>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô (%)</label>
                            <input type="text" id="itemProtein" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 16%">
                        </div>
                        <div class="form-group">
                            <label>‡πÑ‡∏Ç‡∏°‡∏±‡∏ô (%)</label>
                            <input type="text" id="itemFat" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 3%">
                        </div>
                        <div class="form-group">
                            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)</label>
                            <input type="text" id="itemMoisture" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 13%">
                        </div>
                        <div class="form-group">
                            <label>‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢ (%)</label>
                            <input type="text" id="itemFiber" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 14%">
                        </div>
                        <div class="form-group">
                            <label>‡∏Å‡∏≤‡∏Å/‡πÄ‡∏ñ‡πâ‡∏≤ (%)</label>
                            <input type="text" id="itemAsh" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 9%">
                        </div>
                        <div class="form-group">
                            <label>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                            <input type="text" id="itemOther" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 2%">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</label>
                    <textarea id="itemCondition" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏•‡∏¥‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡πÅ‡∏Ç‡πá‡∏á"></textarea>
                </div>
                
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea id="itemNotes" rows="3" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢, ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©"></textarea>
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeItemModal()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn btn-primary" id="saveItemBtn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Item Details Modal -->
    <div class="modal" id="itemDetailsModal">
        <div class="modal-content">
            <h3 id="detailsModalTitle">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
            <div id="itemDetailsContent"></div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-secondary" onclick="closeItemDetailsModal()">‚ùå ‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <script>
        // Global Variables
        let currentUser = null;
        let currentDepartment = 'farm';
        let editingItemId = null;
        let secretClickCount = 0;
        let entryMode = 'quick'; // 'traditional' or 'quick' - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô quick ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        let selectedItemCode = null;
        let quickQuantity = 0;

        // Login Data
        const users = {
            'admin@dairy.co.th': { name: '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', password: 'admin123', role: 'admin', department: 'all' },
            'farm@dairy.co.th': { name: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°', password: 'farm123', role: 'farm', department: 'farm' },
            'breeding@dairy.co.th': { name: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', password: 'breed123', role: 'breeding', department: 'breeding' }
        };

        // Demo Data with transactions
        const demoData = {
            items: {
                farm: {
                    'F001': { name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡∏π‡∏Å‡πÇ‡∏Ñ CP 973', stock: 840, pricePerKg: 19.00, reorderPoint: 500, expiryDate: '2026-12-31', lastModified: new Date().toISOString(), notes: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡∏π‡∏Å‡πÇ‡∏Ñ ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á', specifications: { packaging: '‡∏ñ‡∏∏‡∏á‡∏•‡∏∞ 10 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°', fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 3%', ash: '‡∏Å‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 9%', moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 13%', protein: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 20%', condition: '‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏•‡∏¥‡πà‡∏ô' }, batches: [{ quantity: 840, unitPrice: 19.00, expiryDate: '2026-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000000' }] },
                    'F002': { name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 16%', stock: 9900, pricePerKg: 10.11, reorderPoint: 1000, expiryDate: '2026-06-30', lastModified: new Date().toISOString(), notes: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô 16%', specifications: { packaging: '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 30 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö', protein: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 16', fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 3', fiber: '‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 14', moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 13', other: '‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 2' }, batches: [{ quantity: 9900, unitPrice: 10.11, expiryDate: '2026-06-30', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000001' }] },
                    'F003': { name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 20% (‡∏ú‡∏™‡∏° TMR)', stock: 21510, pricePerKg: 11.675, reorderPoint: 800, expiryDate: '2026-06-30', lastModified: new Date().toISOString(), notes: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô 20% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏™‡∏° TMR', specifications: { packaging: '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 30 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö', protein: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20', fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 3', fiber: '‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 14', moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 13' }, batches: [{ quantity: 21510, unitPrice: 11.675, expiryDate: '2026-06-30', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000002' }] },
                    'F004': { name: '‡∏Å‡∏≤‡∏Å‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á', stock: 4600, pricePerKg: 18.00, reorderPoint: 1000, expiryDate: '2025-12-31', lastModified: new Date().toISOString(), notes: '‡∏Å‡∏≤‡∏Å‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ', specifications: { packaging: '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 50 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö', condition: '‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡πÅ‡∏Ç‡πá‡∏á ‡∏°‡∏µ‡∏™‡∏µ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥', moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 12.5%', protein: '‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 45%', ash: '‡∏°‡∏µ‡∏Å‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 4.5%', fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 2.5%' }, batches: [{ quantity: 4600, unitPrice: 18.00, expiryDate: '2025-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000003' }] },
                    'F005': { name: '‡∏°‡∏±‡∏ô‡πÄ‡∏™‡πâ‡∏ô', stock: 25560, pricePerKg: 8.56, reorderPoint: 2000, expiryDate: '2025-12-31', lastModified: new Date().toISOString(), notes: '‡∏°‡∏±‡∏ô‡πÄ‡∏™‡πâ‡∏ô ‡πÅ‡∏´‡πâ‡∏á‡∏î‡∏µ', specifications: { packaging: '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 60 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö', moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10%', fiber: '‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3.70%', protein: '‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 2.5%', ash: '‡πÄ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3.70%', condition: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏≠‡∏°‡∏õ‡∏ô ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏∂‡πà‡∏á‡πÅ‡∏î‡∏î‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß 3-4 ‡πÅ‡∏î‡∏î' }, batches: [{ quantity: 25560, unitPrice: 8.56, expiryDate: '2025-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000004' }] },
                    'F006': { name: 'MC Miner', stock: 475, pricePerKg: 350.00, reorderPoint: 200, expiryDate: '2027-12-31', lastModified: new Date().toISOString(), notes: '‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏‡∏ú‡∏™‡∏° MC Miner', specifications: { packaging: '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 25 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö' }, batches: [{ quantity: 475, unitPrice: 350.00, expiryDate: '2027-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000005' }] },
                    'F007': { name: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ú‡∏á', stock: 1100, pricePerKg: 55.00, reorderPoint: 100, expiryDate: '2026-03-31', lastModified: new Date().toISOString(), notes: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏ú‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á', specifications: { packaging: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏•‡∏∞ 25 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°', fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 84%', ash: '‡πÄ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 16%', moisture: '‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 5%', other: '‡πÅ‡∏Ñ‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 9%' }, batches: [{ quantity: 1100, unitPrice: 55.00, expiryDate: '2026-03-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000006' }] },
                    'F008': { name: '‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏', stock: 425, pricePerKg: 9.42, reorderPoint: 200, expiryDate: '2027-12-31', lastModified: new Date().toISOString(), notes: '‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏‡∏ú‡∏™‡∏°', specifications: { packaging: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏•‡∏∞ 25 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°' }, batches: [{ quantity: 425, unitPrice: 9.42, expiryDate: '2027-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000007' }] },
                    'F009': { name: '‡∏û‡∏£‡∏µ‡∏°‡∏¥‡∏Å‡∏ã‡πå', stock: 640, pricePerKg: 47.88, reorderPoint: 50, expiryDate: '2026-12-31', lastModified: new Date().toISOString(), notes: '‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏‡∏ú‡∏™‡∏°', specifications: { packaging: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏•‡∏∞ 10 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°' }, batches: [{ quantity: 640, unitPrice: 47.88, expiryDate: '2026-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000008' }] },
                    'F010': { name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 20% (‡∏Ñ‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡πÇ‡∏Ñ)', stock: 0, pricePerKg: 11.675, reorderPoint: 500, expiryDate: '2026-06-30', lastModified: new Date().toISOString(), notes: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô 20% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡πÇ‡∏Ñ', specifications: { packaging: '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 30 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö', protein: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20', fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 3', fiber: '‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 14', moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 13' }, batches: [] }
                },
                breeding: {
                    'B001': { name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 16%', stock: 7170, pricePerKg: 14.17, reorderPoint: 500, expiryDate: '2026-06-30', lastModified: new Date().toISOString(), notes: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', specifications: { packaging: '‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏ 30 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö', protein: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 16', fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 3', fiber: '‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 14', moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 13', other: '‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 2' }, batches: [{ quantity: 7170, unitPrice: 14.17, expiryDate: '2026-06-30', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000009' }] },
                    'B002': { name: '‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏', stock: 50, pricePerKg: 10.90, reorderPoint: 100, expiryDate: '2027-12-31', lastModified: new Date().toISOString(), notes: '‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', specifications: { packaging: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏•‡∏∞ 50 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°' }, batches: [{ quantity: 50, unitPrice: 10.90, expiryDate: '2027-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000010' }] },
                    'B003': { name: '‡∏û‡∏£‡∏µ‡∏°‡∏¥‡∏Å‡∏ã‡πå', stock: 210, pricePerKg: 95.76, reorderPoint: 25, expiryDate: '2026-12-31', lastModified: new Date().toISOString(), notes: '‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', specifications: { packaging: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö‡∏•‡∏∞ 10 ‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°' }, batches: [{ quantity: 210, unitPrice: 95.76, expiryDate: '2026-12-31', dateReceived: '2025-07-01T00:00:00.000Z', batchId: '1719792000011' }] }
                }
            },
            transactions: [
                // Sample transactions for testing reports
                { id: 'T001', date: '2025-07-01', time: '08:30', type: 'in', itemCode: 'F001', itemName: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡∏π‡∏Å‡πÇ‡∏Ñ CP 973', department: 'farm', quantity: 1000, unitPrice: 19.00, totalPrice: 19000, supplier: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó CP', recorder: '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', notes: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', documentRef: 'INV-2025-001' },
                { id: 'T002', date: '2025-07-02', time: '14:15', type: 'out', itemCode: 'F001', itemName: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡∏π‡∏Å‡πÇ‡∏Ñ CP 973', department: 'farm', quantity: 160, unitPrice: 19.00, totalPrice: 3040, supplier: '‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', recorder: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°', notes: '‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡πÇ‡∏Ñ‡∏Ñ‡∏≠‡∏Å A', documentRef: 'REQ-2025-001' },
                { id: 'T003', date: '2025-07-03', time: '09:00', type: 'in', itemCode: 'F002', itemName: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 16%', department: 'farm', quantity: 10000, unitPrice: 10.11, totalPrice: 101100, supplier: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÑ‡∏ó‡∏¢', recorder: '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', notes: '‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ ‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô', documentRef: 'INV-2025-002' },
                { id: 'T004', date: '2025-07-04', time: '16:45', type: 'out', itemCode: 'F002', itemName: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 16%', department: 'farm', quantity: 100, unitPrice: 10.11, totalPrice: 1011, supplier: '‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', recorder: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°', notes: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏™‡∏° TMR', documentRef: 'REQ-2025-002' },
                { id: 'T005', date: '2025-07-05', time: '10:20', type: 'in', itemCode: 'B001', itemName: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 16%', department: 'breeding', quantity: 7500, unitPrice: 14.17, totalPrice: 106275, supplier: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏°', recorder: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', notes: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞', documentRef: 'INV-2025-003' },
                { id: 'T006', date: '2025-07-06', time: '13:30', type: 'out', itemCode: 'B001', itemName: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô 16%', department: 'breeding', quantity: 330, unitPrice: 14.17, totalPrice: 4676.1, supplier: '‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', recorder: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', notes: '‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÇ‡∏Ñ‡∏û‡πà‡∏≠‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå', documentRef: 'REQ-2025-003' },
                { id: 'T007', date: '2025-07-07', time: '11:00', type: 'in', itemCode: 'F006', itemName: 'MC Miner', department: 'farm', quantity: 500, unitPrice: 350.00, totalPrice: 175000, supplier: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏≠‡πá‡∏°.‡∏ã‡∏µ.', recorder: '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£', notes: '‡πÅ‡∏£‡πà‡∏ò‡∏≤‡∏ï‡∏∏‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á', documentRef: 'INV-2025-004' },
                { id: 'T008', date: '2025-07-08', time: '15:20', type: 'out', itemCode: 'F006', itemName: 'MC Miner', department: 'farm', quantity: 25, unitPrice: 350.00, totalPrice: 8750, supplier: '‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', recorder: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°', notes: '‡∏ú‡∏™‡∏°‡πÉ‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ TMR', documentRef: 'REQ-2025-004' }
            ],
            usageHistory: [],
            settings: { lowStockPercent: 20, expiryDays: 7, alertEmail: 'admin@dairy.co.th', anomalyThreshold: 30 }
        };

        // Utility Functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.className = `notification ${type} show`;
            notification.innerHTML = `<div style="display: flex; justify-content: space-between; align-items: center;"><span><strong>${message}</strong></span><button onclick="hideNotification()" style="background: none; border: none; font-size: 1.2rem; cursor: pointer;">√ó</button></div>`;
            setTimeout(() => hideNotification(), 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        function logMessage(message) {
            const debugLog = document.getElementById('debugLog');
            if (debugLog) {
                const time = new Date().toLocaleTimeString();
                debugLog.innerHTML += `[${time}] ${message}<br>`;
                debugLog.scrollTop = debugLog.scrollHeight;
            }
            console.log(message);
        }

        function calculateDaysDifference(dateString) {
            const targetDate = new Date(dateString);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            targetDate.setHours(0, 0, 0, 0);
            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function getExpiryStatus(expiryDate, expiryDays = 7) {
            const daysUntilExpiry = calculateDaysDifference(expiryDate);
            if (daysUntilExpiry < 0) {
                return { status: 'expired', statusClass: 'status-expired', message: '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß' };
            } else if (daysUntilExpiry <= expiryDays) {
                return { status: 'expiring', statusClass: 'status-danger', message: `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${daysUntilExpiry} ‡∏ß‡∏±‡∏ô` };
            } else if (daysUntilExpiry <= expiryDays * 2) {
                return { status: 'warning', statusClass: 'status-warning', message: `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${daysUntilExpiry} ‡∏ß‡∏±‡∏ô` };
            } else {
                return { status: 'normal', statusClass: 'status-normal', message: `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${daysUntilExpiry} ‡∏ß‡∏±‡∏ô` };
            }
        }

        function calculatePackageUnits(stock, packaging) {
            if (!packaging || stock <= 0) return '';
            const numbers = packaging.match(/(\d+(?:\.\d+)?)/g);
            if (!numbers || numbers.length === 0) return '';
            const packageSize = parseFloat(numbers[0]);
            if (packageSize <= 0) return '';
            const units = Math.floor(stock / packageSize);
            const remainder = stock % packageSize;
            let unitType = '‡∏´‡πà‡∏≠';
            if (packaging.includes('‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö')) unitType = '‡∏Å‡∏£‡∏∞‡∏™‡∏≠‡∏ö';
            else if (packaging.includes('‡∏ñ‡∏∏‡∏á')) unitType = '‡∏ñ‡∏∏‡∏á';
            else if (packaging.includes('‡∏Å‡∏•‡πà‡∏≠‡∏á')) unitType = '‡∏Å‡∏•‡πà‡∏≠‡∏á';
            if (units > 0 && remainder > 0) {
                return `(${units} ${unitType} + ${remainder.toFixed(1)} ‡∏Å‡∏Å.)`;
            } else if (units > 0) {
                return `(${units} ${unitType})`;
            } else {
                return `(${remainder.toFixed(1)} ‡∏Å‡∏Å.)`;
            }
        }

        // Permission Functions
        function hasPermission(department) {
            if (!currentUser) return false;
            if (currentUser.role === 'admin') return true;
            return currentUser.department === department;
        }

        function canAccessAllDepartments() {
            return currentUser && currentUser.role === 'admin';
        }

        function getUserDepartments() {
            if (!currentUser) return [];
            if (currentUser.role === 'admin') return ['farm', 'breeding'];
            return [currentUser.department];
        }

        function filterDataByPermission(data) {
            if (canAccessAllDepartments()) return data;
            const userDepts = getUserDepartments();
            const filteredData = {};
            userDepts.forEach(dept => {
                if (data[dept]) {
                    filteredData[dept] = data[dept];
                }
            });
            return filteredData;
        }

        // Login Functions
        function doLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', 'error');
                return;
            }
            
            if (!email.includes('@') || !email.includes('.')) {
                showNotification('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            
            const user = users[email];
            if (user && user.password === password) {
                currentUser = {
                    name: user.name,
                    email: email,
                    role: user.role,
                    department: user.department,
                    lastLogin: new Date().toISOString()
                };
                
                const sessionData = {
                    name: user.name,
                    email: email,
                    role: user.role,
                    department: user.department,
                    loginTime: new Date().toISOString()
                };
                
                showNotification('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                
                document.getElementById('loginPassword').value = '';
                showMainApp();
            } else {
                showNotification('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                document.getElementById('loginPassword').value = '';
            }
        }

        function showSecretPanel() {
            secretClickCount++;
            if (secretClickCount >= 5) {
                toggleDebugMode();
                secretClickCount = 0;
            }
            setTimeout(() => {
                if (secretClickCount > 0) secretClickCount--;
            }, 1000);
        }

        function toggleDebugMode() {
            const debugPanel = document.getElementById('debugInfo');
            if (debugPanel) {
                debugPanel.classList.toggle('hide');
                if (!debugPanel.classList.contains('hide')) {
                    logMessage('üîß Debug mode activated');
                    logMessage('üì± Current user: ' + (currentUser ? currentUser.name + ' (' + currentUser.role + ')' : 'None'));
                    logMessage('üíæ Data status: Available in memory');
                    logMessage('üì¶ Total items: ' + (Object.keys(demoData.items.farm).length + Object.keys(demoData.items.breeding).length));
                    logMessage('üïê Session time: ' + (currentUser ? new Date(currentUser.lastLogin).toLocaleString('th-TH') : 'N/A'));
                }
            }
        }

        function showDebug() {
            toggleDebugMode();
        }

        function logout() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                currentUser = null;
                secretClickCount = 0;
                const debugPanel = document.getElementById('debugInfo');
                if (debugPanel) {
                    debugPanel.classList.add('hide');
                }
                showLoginScreen();
                showNotification('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        }

        // App Functions
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').classList.add('hide');
            
            // Clear login fields for security
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hide');
            
            if (currentUser) {
                document.getElementById('userAvatar').textContent = currentUser.name.charAt(0);
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('recorder').value = currentUser.name;
                setupNavigationByRole();
                if (currentUser.role === 'farm') {
                    currentDepartment = 'farm';
                    selectDepartment('farm');
                } else if (currentUser.role === 'breeding') {
                    currentDepartment = 'breeding';
                    selectDepartment('breeding');
                }
            }
            
            setupCurrentDateTime();
            updateStats();
            updateInventoryTables();
            updateItemSelect();
            updateManagementTable();
            generateAlerts();
            loadAlertSettings();
            updateOverallStats();
            toggleFormFields();
            updateItemSelectorGrid();
            
            // Set quick mode as default
            toggleEntryMode('quick');
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
            quickQuantity = 0;
            
            console.log('Main app loaded, initial quantity:', quickQuantity);
        }

        function setupNavigationByRole() {
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.style.display = 'block');
        }

        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');

            if (sectionName === 'inventory') {
                updateInventoryTables();
            } else if (sectionName === 'management') {
                updateManagementTable();
            } else if (sectionName === 'alerts') {
                generateAlerts();
            } else if (sectionName === 'reports') {
                updateOverallStats();
                setupReportsAccess();
                // Initialize chart when entering reports section
                setTimeout(() => {
                    updateUsageChart();
                }, 100);
            } else if (sectionName === 'record') {
                updateItemSelectorGrid();
            }
        }

        function setupReportsAccess() {
            const reportDeptSelect = document.getElementById('reportDepartment');
            if (reportDeptSelect) {
                reportDeptSelect.innerHTML = '';
                if (currentUser.role === 'admin') {
                    reportDeptSelect.innerHTML = `
                        <option value="all">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                        <option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</option>
                        <option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>
                    `;
                } else if (currentUser.role === 'farm') {
                    reportDeptSelect.innerHTML = '<option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</option>';
                } else if (currentUser.role === 'breeding') {
                    reportDeptSelect.innerHTML = '<option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>';
                }
            }
        }

        function selectDepartment(dept) {
            currentDepartment = dept;
            document.getElementById('deptFarm').classList.toggle('selected', dept === 'farm');
            document.getElementById('deptBreeding').classList.toggle('selected', dept === 'breeding');
            const title = dept === 'farm' ? 'üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö-‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö TMR' : 'üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö-‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡πâ‡∏ô';
            document.getElementById('recordTitle').textContent = title;
            const quickTitle = dept === 'farm' ? '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°' : '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠';
            document.getElementById('quickModeTitle').textContent = quickTitle;
            updateItemSelect();
            updateItemSelectorGrid();
        }

        function setupCurrentDateTime() {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.toTimeString().slice(0, 5);
            
            document.getElementById('recordDate').value = dateStr;
            document.getElementById('recordTime').value = timeStr;
            document.getElementById('quickDate').value = dateStr;
            document.getElementById('quickTime').value = timeStr;
        }

        function updateItemSelect() {
            const select = document.getElementById('itemSelect');
            const items = demoData.items[currentDepartment] || {};
            select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>';
            Object.entries(items).forEach(([code, item]) => {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = item.name;
                option.dataset.pricePerKg = item.pricePerKg;
                select.appendChild(option);
            });
        }

        // Entry Mode Functions
        function toggleEntryMode(mode) {
            entryMode = mode;
            const traditionalForm = document.getElementById('traditionalForm');
            const quickEntryMode = document.getElementById('quickEntryMode');
            const traditionalBtn = document.getElementById('traditionalModeBtn');
            const quickBtn = document.getElementById('quickModeBtn');
            const traditionalBtn2 = document.getElementById('traditionalModeBtn2');
            const quickBtn2 = document.getElementById('quickModeBtn2');
            
            if (mode === 'quick') {
                traditionalForm.classList.add('hide');
                quickEntryMode.classList.remove('hide');
                
                // Update buttons in traditional form
                if (traditionalBtn && quickBtn) {
                    traditionalBtn.classList.remove('btn-primary');
                    traditionalBtn.classList.add('btn-secondary');
                    quickBtn.classList.remove('btn-secondary');
                    quickBtn.classList.add('btn-primary');
                }
                
                // Update buttons in quick mode
                if (traditionalBtn2 && quickBtn2) {
                    traditionalBtn2.classList.remove('btn-primary');
                    traditionalBtn2.classList.add('btn-secondary');
                    quickBtn2.classList.remove('btn-secondary');
                    quickBtn2.classList.add('btn-primary');
                }
                
                updateItemSelectorGrid();
                
            } else {
                traditionalForm.classList.remove('hide');
                quickEntryMode.classList.add('hide');
                
                // Update buttons in traditional form
                if (traditionalBtn && quickBtn) {
                    traditionalBtn.classList.remove('btn-secondary');
                    traditionalBtn.classList.add('btn-primary');
                    quickBtn.classList.remove('btn-primary');
                    quickBtn.classList.add('btn-secondary');
                }
                
                // Update buttons in quick mode
                if (traditionalBtn2 && quickBtn2) {
                    traditionalBtn2.classList.remove('btn-secondary');
                    traditionalBtn2.classList.add('btn-primary');
                    quickBtn2.classList.remove('btn-primary');
                    quickBtn2.classList.add('btn-secondary');
                }
            }
        }

        function updateItemSelectorGrid() {
            const grid = document.getElementById('itemSelectorGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            const items = demoData.items[currentDepartment] || {};
            
            Object.entries(items).forEach(([code, item]) => {
                const button = document.createElement('div');
                button.className = 'item-button';
                button.onclick = () => selectItemForQuickEntry(code);
                
                // Get item icon based on type
                let icon = 'üì¶';
                if (item.name.includes('‡∏≠‡∏≤‡∏´‡∏≤‡∏£')) icon = 'üåæ';
                else if (item.name.includes('‡πÅ‡∏£‡πà')) icon = '‚ö°';
                else if (item.name.includes('‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô') || item.name.includes('‡∏û‡∏£‡∏µ‡∏°‡∏¥‡∏Å‡∏ã‡πå')) icon = 'üíä';
                else if (item.name.includes('‡πÑ‡∏Ç‡∏°‡∏±‡∏ô')) icon = 'üßà';
                else if (item.name.includes('‡∏°‡∏±‡∏ô')) icon = 'ü•î';
                else if (item.name.includes('‡∏ñ‡∏±‡πà‡∏ß')) icon = 'ü´ò';
                
                const stockStatus = item.stock <= (item.reorderPoint * 0.2) ? 
                    (item.stock === 0 ? '‚ö†Ô∏è ‡∏´‡∏°‡∏î' : '‚ö†Ô∏è ‡∏ï‡πà‡∏≥') : 
                    `${item.stock.toLocaleString()} ‡∏Å‡∏Å.`;
                
                button.innerHTML = `
                    <div class="item-icon">${icon}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-stock">${stockStatus}</div>
                `;
                
                grid.appendChild(button);
            });
        }

        function selectItemForQuickEntry(itemCode) {
            selectedItemCode = itemCode;
            const item = demoData.items[currentDepartment][itemCode];
            
            // Update button selections
            document.querySelectorAll('.item-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.closest('.item-button').classList.add('selected');
            
            // Show quick entry panel
            document.getElementById('selectedItemName').textContent = item.name;
            document.getElementById('quickEntryPanel').classList.add('show');
            
            // Reset form
            resetQuickForm();
            
            console.log('Selected item:', itemCode, item.name);
        }

        function adjustQuantity(amount) {
            console.log('adjustQuantity called with amount:', amount);
            console.log('quickQuantity before:', quickQuantity);
            
            quickQuantity = Math.max(0, quickQuantity + amount);
            
            console.log('quickQuantity after:', quickQuantity);
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            const display = document.getElementById('quickQuantityDisplay');
            const input = document.getElementById('quickQuantityInput');
            
            if (display) {
                display.textContent = quickQuantity.toLocaleString();
                console.log('Updated display to:', quickQuantity.toLocaleString());
            }
            
            if (input) {
                input.value = quickQuantity;
                console.log('Updated input to:', quickQuantity);
            }
        }

        function updateQuantityDisplay() {
            const input = document.getElementById('quickQuantityInput');
            const display = document.getElementById('quickQuantityDisplay');
            
            console.log('updateQuantityDisplay called');
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô input
            if (input && input.value !== '' && !isNaN(input.value)) {
                quickQuantity = Math.max(0, parseFloat(input.value) || 0);
                console.log('Updated from input:', quickQuantity);
            }
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            if (display) {
                display.textContent = quickQuantity.toLocaleString();
            }
            if (input) {
                input.value = quickQuantity;
            }
            
            console.log('Final quantity:', quickQuantity);
        }

        function toggleQuickFormFields() {
            const transactionType = document.getElementById('quickTransactionType').value;
            const priceFields = document.getElementById('quickPriceFields');
            
            if (transactionType === 'in') {
                priceFields.style.display = 'block';
                document.getElementById('quickSupplier').required = true;
                document.getElementById('quickSupplier').value = '';
            } else if (transactionType === 'out') {
                priceFields.style.display = 'none';
                document.getElementById('quickSupplier').required = false;
                document.getElementById('quickSupplier').value = '';
            } else {
                priceFields.style.display = 'none';
                document.getElementById('quickSupplier').required = false;
                document.getElementById('quickSupplier').value = '';
            }
        }

        function calculateQuickPricePerKg() {
            const totalPrice = parseFloat(document.getElementById('quickTotalPrice').value);
            if (quickQuantity > 0 && totalPrice > 0) {
                const pricePerKg = totalPrice / quickQuantity;
                document.getElementById('quickUnitPrice').value = pricePerKg.toFixed(2);
            }
        }

        function calculateQuickTotalPrice() {
            const unitPrice = parseFloat(document.getElementById('quickUnitPrice').value);
            if (quickQuantity > 0 && unitPrice > 0) {
                const totalPrice = quickQuantity * unitPrice;
                document.getElementById('quickTotalPrice').value = totalPrice.toFixed(2);
            }
        }

        function submitQuickRecord() {
            if (!selectedItemCode) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö', 'error');
                return;
            }
            
            const transactionType = document.getElementById('quickTransactionType').value;
            const date = document.getElementById('quickDate').value;
            const time = document.getElementById('quickTime').value;
            const notes = document.getElementById('quickNotes').value;
            const documentRef = document.getElementById('quickDocumentRef').value;
            
            if (!transactionType || !date || !time) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            if (quickQuantity <= 0) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0', 'error');
                return;
            }
            
            const item = demoData.items[currentDepartment][selectedItemCode];
            
            if (transactionType === 'in') {
                const totalPrice = parseFloat(document.getElementById('quickTotalPrice').value);
                const unitPrice = parseFloat(document.getElementById('quickUnitPrice').value);
                const supplier = document.getElementById('quickSupplier').value;
                
                if (!totalPrice || !unitPrice || !supplier) {
                    showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢', 'error');
                    return;
                }
                
                // Add transaction record
                const transactionId = 'T' + Date.now();
                const transaction = {
                    id: transactionId,
                    date: date,
                    time: time,
                    type: transactionType,
                    itemCode: selectedItemCode,
                    itemName: item.name,
                    department: currentDepartment,
                    quantity: quickQuantity,
                    unitPrice: unitPrice,
                    totalPrice: totalPrice,
                    supplier: supplier,
                    recorder: currentUser.name,
                    notes: notes,
                    documentRef: documentRef
                };
                
                demoData.transactions.push(transaction);
                showNotification(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ "${item.name}" ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${quickQuantity.toLocaleString()} ‡∏Å‡∏Å. ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
                
            } else if (transactionType === 'out') {
                if (quickQuantity > item.stock) {
                    showNotification(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏°‡∏µ‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${item.stock.toLocaleString()} ‡∏Å‡∏Å.`, 'error');
                    return;
                }
                
                // Add transaction record
                const avgPrice = getAveragePrice(selectedItemCode, currentDepartment);
                const transactionId = 'T' + Date.now();
                const transaction = {
                    id: transactionId,
                    date: date,
                    time: time,
                    type: transactionType,
                    itemCode: selectedItemCode,
                    itemName: item.name,
                    department: currentDepartment,
                    quantity: quickQuantity,
                    unitPrice: avgPrice,
                    totalPrice: quickQuantity * avgPrice,
                    supplier: '‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                    recorder: currentUser.name,
                    notes: notes,
                    documentRef: documentRef
                };
                
                demoData.transactions.push(transaction);
                showNotification(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å "${item.name}" ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${quickQuantity.toLocaleString()} ‡∏Å‡∏Å. ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            }
            
            // Reset and update
            resetQuickForm();
            cancelQuickEntry();
            updateStats();
            updateInventoryTables();
            updateItemSelectorGrid();
        }

        function resetQuickForm() {
            console.log('resetQuickForm called');
            
            quickQuantity = 0; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            const display = document.getElementById('quickQuantityDisplay');
            const input = document.getElementById('quickQuantityInput');
            
            if (display) {
                display.textContent = '0';
                console.log('Reset display to 0');
            }
            
            if (input) {
                input.value = '0';
                console.log('Reset input to 0');
            }
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            document.getElementById('quickTransactionType').value = '';
            document.getElementById('quickTotalPrice').value = '';
            document.getElementById('quickUnitPrice').value = '';
            document.getElementById('quickSupplier').value = '';
            document.getElementById('quickNotes').value = '';
            document.getElementById('quickDocumentRef').value = '';
            toggleQuickFormFields();
            setupCurrentDateTime();
            
            console.log('Quick form reset completed, quantity:', quickQuantity);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å
        function clearQuantity() {
            console.log('clearQuantity called');
            quickQuantity = 0;
            
            const display = document.getElementById('quickQuantityDisplay');
            const input = document.getElementById('quickQuantityInput');
            
            if (display) {
                display.textContent = '0';
                console.log('Cleared display to 0');
            }
            
            if (input) {
                input.value = '0';
                console.log('Cleared input to 0');
            }
        }

        function cancelQuickEntry() {
            selectedItemCode = null;
            document.getElementById('quickEntryPanel').classList.remove('show');
            document.querySelectorAll('.item-button').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
        function testQuantityButton(amount) {
            console.log('testQuantityButton called with:', amount);
            console.log('quickQuantity before adjust:', quickQuantity);
            adjustQuantity(amount);
            console.log('quickQuantity after adjust:', quickQuantity);
        }

        // Other functions... (continuing with all remaining functions)
        function updateStats() {
            const filteredItems = filterDataByPermission(demoData.items);
            const allItems = {};
            Object.values(filteredItems).forEach(deptItems => {
                Object.assign(allItems, deptItems);
            });
            const totalItems = Object.keys(allItems).length;
            let totalValue = 0;
            let farmValue = 0;
            let breedingValue = 0;
            let lowStock = 0;
            let expiringSoon = 0;
            let expiredItems = 0;
            
            if (hasPermission('farm') && demoData.items.farm) {
                Object.values(demoData.items.farm).forEach(item => {
                    const value = item.stock * item.pricePerKg;
                    farmValue += value;
                    totalValue += value;
                    const lowStockThreshold = item.reorderPoint * (demoData.settings.lowStockPercent / 100);
                    if (item.stock <= lowStockThreshold) {
                        lowStock++;
                    }
                    const expiryStatus = getExpiryStatus(item.expiryDate, demoData.settings.expiryDays);
                    if (expiryStatus.status === 'expired') {
                        expiredItems++;
                    } else if (expiryStatus.status === 'expiring') {
                        expiringSoon++;
                    }
                });
            }
            
            if (hasPermission('breeding') && demoData.items.breeding) {
                Object.values(demoData.items.breeding).forEach(item => {
                    const value = item.stock * item.pricePerKg;
                    breedingValue += value;
                    totalValue += value;
                    const lowStockThreshold = item.reorderPoint * (demoData.settings.lowStockPercent / 100);
                    if (item.stock <= lowStockThreshold) {
                        lowStock++;
                    }
                    const expiryStatus = getExpiryStatus(item.expiryDate, demoData.settings.expiryDays);
                    if (expiryStatus.status === 'expired') {
                        expiredItems++;
                    } else if (expiryStatus.status === 'expiring') {
                        expiringSoon++;
                    }
                });
            }
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalValue').textContent = totalValue.toLocaleString('th-TH', { maximumFractionDigits: 0 });
            
            const farmValueCard = document.getElementById('farmValue').closest('.stat-card');
            const breedingValueCard = document.getElementById('breedingValue').closest('.stat-card');
            
            if (hasPermission('farm')) {
                document.getElementById('farmValue').textContent = farmValue.toLocaleString('th-TH', { maximumFractionDigits: 0 });
                farmValueCard.style.display = 'block';
            } else {
                farmValueCard.style.display = 'none';
            }
            
            if (hasPermission('breeding')) {
                document.getElementById('breedingValue').textContent = breedingValue.toLocaleString('th-TH', { maximumFractionDigits: 0 });
                breedingValueCard.style.display = 'block';
            } else {
                breedingValueCard.style.display = 'none';
            }
            
            document.getElementById('lowStock').textContent = lowStock;
            document.getElementById('expiringSoon').textContent = expiringSoon;
            document.getElementById('expiredItems').textContent = expiredItems;
        }

        function getAveragePrice(itemCode, department) {
            const item = demoData.items[department][itemCode];
            if (!item.batches || item.batches.length === 0) return item.pricePerKg;
            let totalValue = 0;
            let totalQuantity = 0;
            item.batches.forEach(batch => {
                totalValue += batch.quantity * batch.unitPrice;
                totalQuantity += batch.quantity;
            });
            return totalQuantity > 0 ? totalValue / totalQuantity : item.pricePerKg;
        }

        function updateInventoryTables() {
            const farmSection = document.querySelector('#inventory .card:first-child');
            const breedingSection = document.querySelector('#inventory .card:last-child');
            
            if (hasPermission('farm')) {
                farmSection.style.display = 'block';
                updateInventoryTable('farm', 'farmInventoryTable');
            } else {
                farmSection.style.display = 'none';
            }
            
            if (hasPermission('breeding')) {
                breedingSection.style.display = 'block';
                updateInventoryTable('breeding', 'breedingInventoryTable');
            } else {
                breedingSection.style.display = 'none';
            }
        }

        function updateInventoryTable(department, tableId) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '';
            const items = demoData.items[department] || {};
            
            if (Object.keys(items).length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #7f8c8d; font-style: italic;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö<br><small>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</small></td></tr>';
                return;
            }
            
            Object.entries(items).forEach(([code, item]) => {
                const row = document.createElement('tr');
                const lowStockThreshold = item.reorderPoint * (demoData.settings.lowStockPercent / 100);
                let stockStatus, stockStatusClass;
                
                if (item.stock === 0) {
                    stockStatus = '‡∏´‡∏°‡∏î';
                    stockStatusClass = 'status-danger';
                } else if (item.stock <= lowStockThreshold) {
                    stockStatus = '‡∏ï‡πà‡∏≥';
                    stockStatusClass = 'status-warning';
                } else {
                    stockStatus = '‡∏õ‡∏Å‡∏ï‡∏¥';
                    stockStatusClass = 'status-normal';
                }

                const expiryStatus = getExpiryStatus(item.expiryDate, demoData.settings.expiryDays);
                let finalStatus, finalStatusClass;
                if (expiryStatus.status === 'expired') {
                    finalStatus = '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
                    finalStatusClass = 'status-expired';
                } else if (expiryStatus.status === 'expiring') {
                    finalStatus = `‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ${expiryStatus.message}`;
                    finalStatusClass = 'status-danger';
                } else if (stockStatus === '‡∏´‡∏°‡∏î') {
                    finalStatus = stockStatus;
                    finalStatusClass = stockStatusClass;
                } else if (stockStatus === '‡∏ï‡πà‡∏≥') {
                    finalStatus = `‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥`;
                    finalStatusClass = stockStatusClass;
                } else {
                    finalStatus = '‡∏õ‡∏Å‡∏ï‡∏¥';
                    finalStatusClass = 'status-normal';
                }
                
                const currentPrice = getAveragePrice(code, department);
                const totalValue = item.stock * currentPrice;
                const expiryDate = new Date(item.expiryDate).toLocaleDateString('th-TH');
                const specs = item.specifications || {};
                const packaging = specs.packaging ? `<br><small style="color: #666;">üì¶ ${specs.packaging}</small>` : '';
                const protein = specs.protein ? `<br><small style="color: #666;">ü•© ${specs.protein}</small>` : '';
                const packageUnits = calculatePackageUnits(item.stock, specs.packaging);
                const stockDisplay = packageUnits ? 
                    `<strong>${item.stock.toLocaleString()}</strong><br><small style="color: #999; font-size: 0.8rem;">${packageUnits}</small>` : 
                    `<strong>${item.stock.toLocaleString()}</strong>`;
                
                row.innerHTML = `
                    <td>
                        <strong>${item.name}</strong><br>
                        <small style="color: #666;">${code}</small>
                        ${packaging}${protein}
                    </td>
                    <td>${stockDisplay}</td>
                    <td>${currentPrice.toFixed(2)}<br><small style="color: #666;">FIFO</small></td>
                    <td><strong style="color: #27ae60;">${totalValue.toLocaleString('th-TH', { maximumFractionDigits: 0 })}</strong></td>
                    <td>${expiryDate}</td>
                    <td><span class="status-badge ${finalStatusClass}">${finalStatus}</span></td>
                    <td style="text-align: center; white-space: nowrap;">
                        <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-info btn-sm" onclick="showItemDetails('${code}', '${department}')" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                                ‚ÑπÔ∏è ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="editItem('${code}', '${department}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('${code}', '${department}')" title="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Continue with all remaining functions...
        function generateAlerts() {
            const container = document.getElementById('alertsContent');
            const filteredItems = filterDataByPermission(demoData.items);
            const allItems = {};
            Object.values(filteredItems).forEach(deptItems => {
                Object.assign(allItems, deptItems);
            });
            let alerts = [];
            
            Object.entries(allItems).forEach(([code, item]) => {
                const expiryStatus = getExpiryStatus(item.expiryDate, demoData.settings.expiryDays);
                if (expiryStatus.status === 'expired') {
                    alerts.push({
                        type: 'danger',
                        message: `${item.name} - ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß (${new Date(item.expiryDate).toLocaleDateString('th-TH')})`
                    });
                } else if (expiryStatus.status === 'expiring') {
                    alerts.push({
                        type: 'warning',
                        message: `${item.name} - ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ${expiryStatus.message} (${new Date(item.expiryDate).toLocaleDateString('th-TH')})`
                    });
                }
                const lowStockThreshold = item.reorderPoint * (demoData.settings.lowStockPercent / 100);
                if (item.stock === 0) {
                    alerts.push({
                        type: 'danger',
                        message: `${item.name} - ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏´‡∏°‡∏î (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)`
                    });
                } else if (item.stock <= lowStockThreshold) {
                    alerts.push({
                        type: 'warning',
                        message: `${item.name} - ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${item.stock.toLocaleString()} ‡∏Å‡∏Å.`
                    });
                }
            });
            
            if (alerts.length === 0) {
                container.innerHTML = '<div class="alert alert-success"><strong>‚úÖ ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏Å‡∏ï‡∏¥:</strong> ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>';
                return;
            }
            
            const groupedAlerts = alerts.reduce((acc, alert) => {
                if (!acc[alert.type]) acc[alert.type] = [];
                acc[alert.type].push(alert.message);
                return acc;
            }, {});
            
            let alertsHTML = '';
            if (groupedAlerts.danger) {
                alertsHTML += `
                    <div class="alert alert-danger">
                        <strong>üö® ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            ${groupedAlerts.danger.map(msg => `<li>${msg}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            if (groupedAlerts.warning) {
                alertsHTML += `
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            ${groupedAlerts.warning.map(msg => `<li>${msg}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            container.innerHTML = alertsHTML;
        }

        // Add all remaining functions from the original file...
        function updateManagementTable() {
            const filterDeptSelect = document.getElementById('filterDepartment');
            if (filterDeptSelect) {
                filterDeptSelect.innerHTML = '<option value="all">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>';
                if (hasPermission('farm')) {
                    filterDeptSelect.innerHTML += '<option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°</option>';
                }
                if (hasPermission('breeding')) {
                    filterDeptSelect.innerHTML += '<option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠</option>';
                }
            }
            sortManagementTable();
        }

        function sortManagementTable() {
            const sortBy = document.getElementById('sortBy').value;
            const filterDept = document.getElementById('filterDepartment').value;
            const filterStatus = document.getElementById('filterStatus').value;
            let allItems = [];
            
            if (hasPermission('farm') && demoData.items.farm) {
                Object.entries(demoData.items.farm).forEach(([code, item]) => {
                    allItems.push({ ...item, code, department: 'farm', departmentName: '‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°' });
                });
            }
            if (hasPermission('breeding') && demoData.items.breeding) {
                Object.entries(demoData.items.breeding).forEach(([code, item]) => {
                    allItems.push({ ...item, code, department: 'breeding', departmentName: '‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏Ø' });
                });
            }
            
            if (filterDept !== 'all') {
                allItems = allItems.filter(item => item.department === filterDept);
            }
            if (filterStatus !== 'all') {
                allItems = allItems.filter(item => {
                    const lowStockThreshold = item.reorderPoint * (demoData.settings.lowStockPercent / 100);
                    const expiryStatus = getExpiryStatus(item.expiryDate, demoData.settings.expiryDays);
                    let status = 'normal';
                    if (expiryStatus.status === 'expired') {
                        status = 'expired';
                    } else if (expiryStatus.status === 'expiring' || item.stock === 0) {
                        status = 'danger';
                    } else if (expiryStatus.status === 'warning' || item.stock <= lowStockThreshold) {
                        status = 'warning';
                    }
                    return status === filterStatus;
                });
            }
            
            allItems.sort((a, b) => {
                switch (sortBy) {
                    case 'name': return a.name.localeCompare(b.name, 'th');
                    case 'name_desc': return b.name.localeCompare(a.name, 'th');
                    case 'department': return a.departmentName.localeCompare(b.departmentName, 'th');
                    case 'stock_desc': return b.stock - a.stock;
                    case 'stock_asc': return a.stock - b.stock;
                    case 'price_desc': return getAveragePrice(b.code, b.department) - getAveragePrice(a.code, a.department);
                    case 'price_asc': return getAveragePrice(a.code, a.department) - getAveragePrice(b.code, b.department);
                    case 'expiry_asc': return new Date(a.expiryDate) - new Date(b.expiryDate);
                    case 'expiry_desc': return new Date(b.expiryDate) - new Date(a.expiryDate);
                    case 'status':
                        const getStatusPriority = (item) => {
                            const lowStockThreshold = item.reorderPoint * (demoData.settings.lowStockPercent / 100);
                            const expiryStatus = getExpiryStatus(item.expiryDate, demoData.settings.expiryDays);
                            if (expiryStatus.status === 'expired') return 1;
                            if (expiryStatus.status === 'expiring' || item.stock === 0) return 2;
                            if (expiryStatus.status === 'warning' || item.stock <= lowStockThreshold) return 3;
                            return 4;
                        };
                        return getStatusPriority(a) - getStatusPriority(b);
                    default: return 0;
                }
            });
            
            const tbody = document.getElementById('managementTable');
            tbody.innerHTML = '';
            if (allItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</td></tr>';
                return;
            }
            
            allItems.forEach(item => {
                const row = document.createElement('tr');
                const lowStockThreshold = item.reorderPoint * (demoData.settings.lowStockPercent / 100);
                const expiryStatus = getExpiryStatus(item.expiryDate, demoData.settings.expiryDays);
                let finalStatus, finalStatusClass;
                if (expiryStatus.status === 'expired') {
                    finalStatus = '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏';
                    finalStatusClass = 'status-expired';
                } else if (expiryStatus.status === 'expiring') {
                    finalStatus = `‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ${expiryStatus.message}`;
                    finalStatusClass = 'status-danger';
                } else if (item.stock === 0) {
                    finalStatus = '‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏´‡∏°‡∏î';
                    finalStatusClass = 'status-danger';
                } else if (item.stock <= lowStockThreshold) {
                    finalStatus = '‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥';
                    finalStatusClass = 'status-warning';
                } else {
                    finalStatus = '‡∏õ‡∏Å‡∏ï‡∏¥';
                    finalStatusClass = 'status-normal';
                }
                
                const currentPrice = getAveragePrice(item.code, item.department);
                const expiryDate = new Date(item.expiryDate).toLocaleDateString('th-TH');
                const specs = item.specifications || {};
                const packageUnits = calculatePackageUnits(item.stock, specs.packaging);
                const stockDisplay = packageUnits ? 
                    `${item.stock.toLocaleString()}<br><small style="color: #999; font-size: 0.8rem;">${packageUnits}</small>` : 
                    item.stock.toLocaleString();
                
                row.innerHTML = `
                    <td><strong>${item.name}</strong><br><small style="color: #666;">${item.code}</small></td>
                    <td>${item.departmentName}</td>
                    <td>${stockDisplay}</td>
                    <td>${currentPrice.toFixed(2)}</td>
                    <td>${expiryDate}</td>
                    <td><span class="status-badge ${finalStatusClass}">${finalStatus}</span></td>
                    <td style="text-align: center; white-space: nowrap;">
                        <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-info btn-sm" onclick="showItemDetails('${item.code}', '${item.department}')" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                                ‚ÑπÔ∏è ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="editItem('${item.code}', '${item.department}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.code}', '${item.department}')" title="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Add all other remaining functions here (item management, reports, etc.)
        function showItemModal() {
            const userDepts = getUserDepartments();
            if (userDepts.length === 0) {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà', 'error');
                return;
            }
            editingItemId = null;
            document.getElementById('modalTitle').textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('saveItemBtn').textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            document.getElementById('itemForm').reset();
            const deptSelect = document.getElementById('itemDepartment');
            deptSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>';
            if (currentUser.role === 'admin') {
                deptSelect.innerHTML += '<option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏° (TMR)</option>';
                deptSelect.innerHTML += '<option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>';
            } else {
                if (currentUser.role === 'farm') {
                    deptSelect.innerHTML += '<option value="farm">‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏° (TMR)</option>';
                    deptSelect.value = 'farm';
                    deptSelect.disabled = true;
                } else if (currentUser.role === 'breeding') {
                    deptSelect.innerHTML += '<option value="breeding">‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</option>';
                    deptSelect.value = 'breeding';
                    deptSelect.disabled = true;
                }
            }
            document.getElementById('itemModal').classList.add('show');
        }

        function closeItemModal() {
            document.getElementById('itemModal').classList.remove('show');
            document.getElementById('itemDepartment').disabled = false;
            document.getElementById('itemForm').reset();
            ['itemPackaging', 'itemProtein', 'itemFat', 'itemMoisture', 'itemFiber', 'itemAsh', 'itemOther', 'itemCondition'].forEach(id => {
                document.getElementById(id).value = '';
            });
            editingItemId = null;
        }

        function editItem(code, department) {
            if (!hasPermission(department)) {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏ô‡∏µ‡πâ', 'error');
                return;
            }
            if (currentUser.role !== 'admin' && currentUser.department !== department) {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                return;
            }
            const item = demoData.items[department][code];
            if (!item) return;
            editingItemId = code;
            document.getElementById('modalTitle').textContent = `‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${item.name}`;
            document.getElementById('saveItemBtn').textContent = 'üíæ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó';
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemDepartment').value = department;
            document.getElementById('itemReorder').value = item.reorderPoint;
            document.getElementById('itemNotes').value = item.notes || '';
            const specs = item.specifications || {};
            ['itemPackaging', 'itemProtein', 'itemFat', 'itemMoisture', 'itemFiber', 'itemAsh', 'itemOther', 'itemCondition'].forEach(id => {
                const key = id.replace('item', '').toLowerCase();
                document.getElementById(id).value = specs[key] || '';
            });
            const deptSelect = document.getElementById('itemDepartment');
            if (currentUser.role !== 'admin') {
                deptSelect.disabled = true;
            }
            document.getElementById('itemModal').classList.add('show');
        }

        function deleteItem(code, department) {
            if (!hasPermission(department)) {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏ô‡∏µ‡πâ', 'error');
                return;
            }
            if (currentUser.role !== 'admin' && currentUser.department !== department) {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                return;
            }
            const item = demoData.items[department][code];
            if (!item) return;
            if (item.stock > 0) {
                showNotification(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${item.name}" ‡πÑ‡∏î‡πâ\n\n‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${item.stock.toLocaleString()} ‡∏Å‡∏Å.\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0`, 'error');
                return;
            }
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${item.name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`)) {
                delete demoData.items[department][code];
                showNotification(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${item.name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                updateStats();
                updateInventoryTables();
                updateManagementTable();
                updateItemSelect();
                updateItemSelectorGrid();
                generateAlerts();
            }
        }

        function saveItem(event) {
            event.preventDefault();
            const name = document.getElementById('itemName').value;
            const department = document.getElementById('itemDepartment').value;
            const reorderPoint = parseFloat(document.getElementById('itemReorder').value);
            const notes = document.getElementById('itemNotes').value;
            const specifications = {};
            ['packaging', 'protein', 'fat', 'moisture', 'fiber', 'ash', 'other', 'condition'].forEach(key => {
                const value = document.getElementById('item' + key.charAt(0).toUpperCase() + key.slice(1)).value;
                if (value) specifications[key] = value;
            });
            
            if (!hasPermission(department)) {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏ô‡∏µ‡πâ', 'error');
                return;
            }
            if (currentUser.role !== 'admin' && currentUser.department !== department) {
                showNotification('‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                return;
            }
            
            if (editingItemId) {
                const item = demoData.items[department][editingItemId];
                item.name = name;
                item.reorderPoint = reorderPoint;
                item.notes = notes;
                item.specifications = specifications;
                item.lastModified = new Date().toISOString();
                showNotification(`‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
            } else {
                const existingItems = demoData.items[department] || {};
                const prefix = department === 'farm' ? 'F' : 'B';
                const nextNumber = Object.keys(existingItems).length + 1;
                const newCode = `${prefix}${nextNumber.toString().padStart(3, '0')}`;
                const defaultExpiry = new Date();
                defaultExpiry.setFullYear(defaultExpiry.getFullYear() + 1);
                demoData.items[department][newCode] = {
                    name: name,
                    stock: 0,
                    pricePerKg: 0,
                    reorderPoint: reorderPoint,
                    expiryDate: defaultExpiry.toISOString().split('T')[0],
                    notes: notes,
                    specifications: specifications,
                    batches: [],
                    lastModified: new Date().toISOString()
                };
                showNotification(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: 0 ‡∏Å‡∏Å. (‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤)`, 'success');
            }
            closeItemModal();
            updateStats();
            updateInventoryTables();
            updateManagementTable();
            updateItemSelect();
            updateItemSelectorGrid();
            generateAlerts();
        }

        function showItemDetails(code, department) {
            const item = demoData.items[department][code];
            if (!item) return;
            document.getElementById('detailsModalTitle').textContent = `üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö: ${item.name}`;
            const specs = item.specifications || {};
            const batches = item.batches || [];
            let detailsHTML = `
                <div class="form-grid" style="margin-bottom: 25px;">
                    <div class="form-group">
                        <label>‡∏£‡∏´‡∏±‡∏™‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">${code}</div>
                    </div>
                    <div class="form-group">
                        <label>‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;"><strong>${item.stock.toLocaleString()} ‡∏Å‡∏Å.</strong></div>
                    </div>
                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ FIFO</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;"><strong>${getAveragePrice(code, department).toFixed(2)} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.</strong></div>
                    </div>
                    <div class="form-group">
                        <label>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</label>
                        <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;"><strong>${(item.stock * getAveragePrice(code, department)).toLocaleString()} ‡∏ö‡∏≤‡∏ó</strong></div>
                    </div>
                </div>
                <h4>üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞</h4>
                <div class="table-container" style="margin-bottom: 25px;">
                    <table class="table">
                        <tbody>
            `;
            Object.entries(specs).forEach(([key, value]) => {
                if (value) {
                    const labels = {
                        packaging: '‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå',
                        protein: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô',
                        fat: '‡πÑ‡∏Ç‡∏°‡∏±‡∏ô',
                        moisture: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô',
                        fiber: '‡πÄ‡∏¢‡∏∑‡πà‡∏≠‡πÉ‡∏¢',
                        ash: '‡∏Å‡∏≤‡∏Å/‡πÄ‡∏ñ‡πâ‡∏≤',
                        other: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
                        condition: '‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û'
                    };
                    detailsHTML += `<tr><td><strong>${labels[key] || key}</strong></td><td>${value}</td></tr>`;
                }
            });
            detailsHTML += `</tbody></table></div>`;
            
            if (batches.length > 0) {
                detailsHTML += `
                    <h4>üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Batch (FIFO)</h4>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</th>
                                    <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏Å‡∏Å.)</th>
                                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                    <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                batches.forEach(batch => {
                    const dateReceived = new Date(batch.dateReceived).toLocaleDateString('th-TH');
                    const expiryDate = new Date(batch.expiryDate).toLocaleDateString('th-TH');
                    const value = batch.quantity * batch.unitPrice;
                    detailsHTML += `
                        <tr>
                            <td>${dateReceived}</td>
                            <td><strong>${batch.quantity.toLocaleString()}</strong></td>
                            <td>${batch.unitPrice.toFixed(2)}</td>
                            <td>${expiryDate}</td>
                            <td><strong>${value.toLocaleString()}</strong></td>
                        </tr>
                    `;
                });
                detailsHTML += `</tbody></table></div>`;
            } else {
                detailsHTML += `
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Batch:</strong> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö FIFO
                    </div>
                `;
            }
            if (item.notes) {
                detailsHTML += `
                    <h4>üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h4>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
                        ${item.notes}
                    </div>
                `;
            }
            document.getElementById('itemDetailsContent').innerHTML = detailsHTML;
            document.getElementById('itemDetailsModal').classList.add('show');
        }

        function closeItemDetailsModal() {
            document.getElementById('itemDetailsModal').classList.remove('show');
        }

        // Add remaining form functions, export functions, report functions...
        function toggleFormFields() {
            const transactionType = document.getElementById('transactionType').value;
            const priceInputGroups = document.querySelectorAll('.price-input-group');
            const supplierGroup = document.querySelector('.supplier-group');
            const totalPriceInput = document.getElementById('totalPrice');
            const unitPriceInput = document.getElementById('unitPrice');
            const supplierInput = document.getElementById('supplier');
            
            if (transactionType === 'out') {
                priceInputGroups.forEach(group => {
                    group.style.display = 'none';
                });
                supplierGroup.style.display = 'none';
                totalPriceInput.required = false;
                unitPriceInput.required = false;
                supplierInput.required = false;
                totalPriceInput.value = '';
                unitPriceInput.value = '';
                supplierInput.value = '';
            } else if (transactionType === 'in') {
                priceInputGroups.forEach(group => {
                    group.style.display = 'block';
                });
                supplierGroup.style.display = 'block';
                supplierInput.required = true;
                supplierInput.value = '';
            } else {
                priceInputGroups.forEach(group => {
                    group.style.display = 'block';
                });
                supplierGroup.style.display = 'block';
                supplierInput.required = true;
                supplierInput.value = '';
            }
        }

        function submitRecord(event) {
            event.preventDefault();
            showNotification('‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Demo ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\n‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'info');
        }

        function resetForm() {
            document.querySelector('#recordForm').reset();
            setupCurrentDateTime();
            if (currentUser) {
                document.getElementById('recorder').value = currentUser.name;
            }
            document.getElementById('totalPrice').value = '';
            document.getElementById('unitPrice').value = '';
            document.getElementById('supplier').value = '';
            toggleFormFields();
        }

        function refreshData() {
            updateStats();
            updateInventoryTables();
            updateManagementTable();
            generateAlerts();
            updateItemSelectorGrid();
            showNotification('‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        function exportToExcel() {
            try {
                const workbook = XLSX.utils.book_new();
                const today = new Date().toLocaleDateString('th-TH');
                const departments = [];
                if (hasPermission('farm')) departments.push({ key: 'farm', name: '‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡∏ô‡∏°' });
                if (hasPermission('breeding')) departments.push({ key: 'breeding', name: '‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡∏∑‡πâ‡∏≠' });
                
                departments.forEach(dept => {
                    const items = demoData.items[dept.key] || {};
                    const worksheetData = [];
                    worksheetData.push([
                        '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö - ' + dept.name,
                        '', '', '', '', '', '', ''
                    ]);
                    worksheetData.push([
                        '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡∏±‡∏ö: ' + today,
                        '', '', '', '', '', '', ''
                    ]);
                    worksheetData.push([
                        '‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡∏±‡∏ö: _________________________',
                        '', '', '', '', '', '', ''
                    ]);
                    worksheetData.push([]);
                    worksheetData.push([
                        '‡∏£‡∏´‡∏±‡∏™',
                        '‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö',
                        '‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏Å‡∏Å.)',
                        '‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏',
                        '‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å.',
                        '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)',
                        '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏£‡∏¥‡∏á (‡∏Å‡∏Å.)',
                        '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏'
                    ]);
                    
                    let totalSystemStock = 0;
                    let totalValue = 0;
                    Object.entries(items).forEach(([code, item]) => {
                        const specs = item.specifications || {};
                        const packageUnits = calculatePackageUnits(item.stock, specs.packaging);
                        const currentPrice = getAveragePrice(code, dept.key);
                        const value = item.stock * currentPrice;
                        totalSystemStock += item.stock;
                        totalValue += value;
                        worksheetData.push([
                            code,
                            item.name,
                            item.stock,
                            packageUnits || '',
                            currentPrice.toFixed(2),
                            Math.round(value),
                            '',
                            ''
                        ]);
                    });
                    
                    worksheetData.push([]);
                    worksheetData.push([
                        '‡∏£‡∏ß‡∏°',
                        '',
                        totalSystemStock,
                        '',
                        '',
                        Math.round(totalValue),
                        '',
                        ''
                    ]);
                    
                    const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
                    worksheet['!cols'] = [
                        { width: 8 },
                        { width: 25 },
                        { width: 15 },
                        { width: 15 },
                        { width: 12 },
                        { width: 15 },
                        { width: 15 },
                        { width: 20 }
                    ];
                    XLSX.utils.book_append_sheet(workbook, worksheet, dept.name);
                });
                
                const fileName = `‡∏≠‡∏™‡∏Ñ-‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö-${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(workbook, fileName);
                showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢\n‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡∏±‡∏ö', 'success');
            } catch (error) {
                console.error('Export Excel error:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel', 'error');
            }
        }

        function exportData() {
            try {
                const data = {
                    items: demoData.items,
                    transactions: demoData.transactions,
                    settings: demoData.settings,
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `‡∏≠‡∏™‡∏Ñ-‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πä‡∏≠‡∏Å-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            } catch (error) {
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        function backupData() {
            try {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const backupData = {
                    ...demoData,
                    backupDate: new Date().toISOString(),
                    backupBy: currentUser?.email || 'unknown',
                    version: '2.1',
                    systemInfo: {
                        userAgent: navigator.userAgent,
                        timestamp: timestamp,
                        totalItems: Object.keys(demoData.items.farm).length + Object.keys(demoData.items.breeding).length,
                        totalTransactions: demoData.transactions.length
                    }
                };
                
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `SmartStock-Backup-${timestamp}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification(`‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢\n‡πÑ‡∏ü‡∏•‡πå: SmartStock-Backup-${timestamp}.json`, 'success');
            } catch (error) {
                console.error('Backup error:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        function saveAlertSettings() {
            const lowStockPercent = parseInt(document.getElementById('lowStockPercent').value);
            const expiryDays = parseInt(document.getElementById('expiryDays').value);
            const alertEmail = document.getElementById('alertEmail').value;
            demoData.settings.lowStockPercent = lowStockPercent;
            demoData.settings.expiryDays = expiryDays;
            demoData.settings.alertEmail = alertEmail;
            showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            generateAlerts();
            updateStats();
            updateInventoryTables();
            updateManagementTable();
        }

        function loadAlertSettings() {
            if (demoData.settings) {
                document.getElementById('lowStockPercent').value = demoData.settings.lowStockPercent || 20;
                document.getElementById('expiryDays').value = demoData.settings.expiryDays || 7;
                document.getElementById('alertEmail').value = demoData.settings.alertEmail || '';
            }
        }

        // Chart Functions
        function updateUsageChart() {
            const canvas = document.getElementById('usageChart');
            const ctx = canvas.getContext('2d');
            const period = document.getElementById('chartPeriod').value;
            const department = document.getElementById('chartDepartment').value;
            const chartType = document.getElementById('chartType').value;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Get usage data
            const usageData = getUsageData(period, department);
            
            if (usageData.length === 0) {
                // Show no data message
                ctx.fillStyle = '#7f8c8d';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            if (chartType === 'pie') {
                drawPieChart(ctx, usageData, canvas.width, canvas.height);
            } else if (chartType === 'line') {
                drawLineChart(ctx, usageData, canvas.width, canvas.height);
            } else {
                drawBarChart(ctx, usageData, canvas.width, canvas.height);
            }
        }

        function getUsageData(period, department) {
            let filteredTransactions = demoData.transactions.filter(t => t.type === 'out');
            
            if (department !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.department === department);
            }
            
            const today = new Date();
            let data = [];
            
            if (period === 'daily') {
                // Last 7 days
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const dayUsage = filteredTransactions
                        .filter(t => t.date === dateStr)
                        .reduce((sum, t) => sum + t.quantity, 0);
                    data.push({
                        label: date.toLocaleDateString('th-TH', { month: 'short', day: 'numeric' }),
                        value: dayUsage
                    });
                }
            } else if (period === 'monthly') {
                // Last 6 months
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                    const monthStr = date.toISOString().substr(0, 7);
                    const monthUsage = filteredTransactions
                        .filter(t => t.date.startsWith(monthStr))
                        .reduce((sum, t) => sum + t.quantity, 0);
                    data.push({
                        label: date.toLocaleDateString('th-TH', { year: 'numeric', month: 'short' }),
                        value: monthUsage
                    });
                }
            } else if (period === 'quarterly') {
                // Last 4 quarters
                const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
                for (let i = 3; i >= 0; i--) {
                    const currentQuarter = Math.floor(today.getMonth() / 3);
                    const targetQuarter = (currentQuarter - i + 4) % 4;
                    const targetYear = targetQuarter > currentQuarter ? today.getFullYear() - 1 : today.getFullYear();
                    
                    const startMonth = targetQuarter * 3;
                    const endMonth = startMonth + 2;
                    
                    const quarterUsage = filteredTransactions
                        .filter(t => {
                            const transDate = new Date(t.date);
                            return transDate.getFullYear() === targetYear && 
                                   transDate.getMonth() >= startMonth && 
                                   transDate.getMonth() <= endMonth;
                        })
                        .reduce((sum, t) => sum + t.quantity, 0);
                    
                    data.push({
                        label: `${quarters[targetQuarter]} ${targetYear}`,
                        value: quarterUsage
                    });
                }
            } else if (period === 'yearly') {
                // Last 3 years
                for (let i = 2; i >= 0; i--) {
                    const year = today.getFullYear() - i;
                    const yearUsage = filteredTransactions
                        .filter(t => new Date(t.date).getFullYear() === year)
                        .reduce((sum, t) => sum + t.quantity, 0);
                    data.push({
                        label: year.toString(),
                        value: yearUsage
                    });
                }
            }
            
            return data.filter(d => d.value > 0);
        }

        function drawBarChart(ctx, data, width, height) {
            const padding = 60;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            const maxValue = Math.max(...data.map(d => d.value));
            const barWidth = chartWidth / data.length * 0.8;
            const barSpacing = chartWidth / data.length * 0.2;
            
            // Draw background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, width, height);
            
            // Draw title
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)', width / 2, 30);
            
            // Draw axes
            ctx.strokeStyle = '#dee2e6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Draw bars
            data.forEach((item, index) => {
                const barHeight = (item.value / maxValue) * chartHeight;
                const x = padding + index * (barWidth + barSpacing) + barSpacing / 2;
                const y = height - padding - barHeight;
                
                // Bar gradient
                const gradient = ctx.createLinearGradient(0, y, 0, y + barHeight);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Bar border
                ctx.strokeStyle = '#5a67d8';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, y, barWidth, barHeight);
                
                // Value label on top of bar
                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(item.value.toLocaleString(), x + barWidth / 2, y - 5);
                
                // X-axis label
                ctx.save();
                ctx.translate(x + barWidth / 2, height - padding + 20);
                ctx.rotate(-Math.PI / 6);
                ctx.fillStyle = '#6c757d';
                ctx.font = '11px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(item.label, 0, 0);
                ctx.restore();
            });
            
            // Y-axis labels
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const value = (maxValue / ySteps) * i;
                const y = height - padding - (i / ySteps) * chartHeight;
                
                ctx.fillStyle = '#6c757d';
                ctx.font = '11px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(value).toLocaleString(), padding - 10, y + 3);
                
                // Grid lines
                ctx.strokeStyle = '#e9ecef';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
        }

        function drawLineChart(ctx, data, width, height) {
            const padding = 60;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            const maxValue = Math.max(...data.map(d => d.value));
            
            // Draw background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, width, height);
            
            // Draw title
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)', width / 2, 30);
            
            // Draw axes
            ctx.strokeStyle = '#dee2e6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Draw grid lines
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = height - padding - (i / ySteps) * chartHeight;
                ctx.strokeStyle = '#e9ecef';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
                
                // Y-axis labels
                const value = (maxValue / ySteps) * i;
                ctx.fillStyle = '#6c757d';
                ctx.font = '11px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(value).toLocaleString(), padding - 10, y + 3);
            }
            
            // Draw line
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((item, index) => {
                const x = padding + (index / (data.length - 1)) * chartWidth;
                const y = height - padding - (item.value / maxValue) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Draw points
            data.forEach((item, index) => {
                const x = padding + (index / (data.length - 1)) * chartWidth;
                const y = height - padding - (item.value / maxValue) * chartHeight;
                
                // Point circle
                ctx.fillStyle = '#764ba2';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
                
                // Point border
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Value label
                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(item.value.toLocaleString(), x, y - 10);
                
                // X-axis label
                ctx.fillStyle = '#6c757d';
                ctx.font = '11px Arial';
                ctx.fillText(item.label, x, height - padding + 20);
            });
        }

        function drawPieChart(ctx, data, width, height) {
            // Sort data by value and take top 8
            const sortedData = data.sort((a, b) => b.value - a.value).slice(0, 8);
            const total = sortedData.reduce((sum, item) => sum + item.value, 0);
            
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            // Draw background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, width, height);
            
            // Draw title
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°', width / 2, 30);
            
            // Colors for pie slices
            const colors = [
                '#667eea', '#764ba2', '#f093fb', '#f5576c',
                '#4facfe', '#00f2fe', '#43e97b', '#38f9d7'
            ];
            
            let currentAngle = -Math.PI / 2; // Start from top
            
            sortedData.forEach((item, index) => {
                const sliceAngle = (item.value / total) * 2 * Math.PI;
                
                // Draw pie slice
                ctx.fillStyle = colors[index % colors.length];
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();
                
                // Draw slice border
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Draw percentage label
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                const percentage = ((item.value / total) * 100).toFixed(1);
                
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${percentage}%`, labelX, labelY);
                
                currentAngle += sliceAngle;
            });
            
            // Draw legend
            const legendX = width - 200;
            let legendY = 80;
            
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:', legendX, legendY);
            legendY += 25;
            
            sortedData.forEach((item, index) => {
                // Legend color box
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(legendX, legendY - 10, 15, 15);
                
                // Legend text
                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Arial';
                const text = item.label.length > 20 ? item.label.substring(0, 17) + '...' : item.label;
                ctx.fillText(`${text} (${item.value.toLocaleString()} ‡∏Å‡∏Å.)`, legendX + 20, legendY + 2);
                
                legendY += 20;
            });
        }

        function exportReportToExcel() {
            showNotification('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á', 'info');
        }

        function detectAnomalies() {
            showNotification('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á', 'info');
        }

        function updateOverallStats() {
            const totalTransactions = demoData.transactions.length;
            const outTransactions = demoData.transactions.filter(t => t.type === 'out');
            const avgDailyUsage = outTransactions.length > 0 ? 
                outTransactions.reduce((sum, t) => sum + t.quantity, 0) / 7 : 0;
            
            let peakDay = '-';
            let mostUsedItem = '-';
            
            document.getElementById('totalTransactions').textContent = totalTransactions;
            document.getElementById('avgDailyUsage').textContent = avgDailyUsage.toFixed(1);
            document.getElementById('peakUsageDay').textContent = peakDay;
            document.getElementById('mostUsedItem').textContent = mostUsedItem;
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ SmartStock System Starting...');
            
            // Clear login fields for security
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            
            showLoginScreen();
        });

        // Event Listeners
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && document.getElementById('loginScreen').style.display !== 'none') {
                doLogin();
            }
            if (event.key === 'Escape') {
                closeItemModal();
                closeItemDetailsModal();
                cancelQuickEntry();
            }
        });

        document.getElementById('itemModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeItemModal();
            }
        });

        document.getElementById('itemDetailsModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeItemDetailsModal();
            }
        });
    </script>
</body>
</html>